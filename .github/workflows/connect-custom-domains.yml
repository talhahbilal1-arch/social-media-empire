name: Connect Custom Domains to Vercel (run once)

on:
  workflow_dispatch:

jobs:
  connect:
    runs-on: ubuntu-latest
    steps:
      - name: Add fitover35.com domains
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_BRAND_TOKEN }}
          PROJECT_ID: prj_xJ3y2gstjJktWHGtMpVJPAAIUiFy
        run: |
          for DOMAIN in fitover35.com www.fitover35.com; do
            echo "Adding $DOMAIN..."
            curl -s -X POST "https://api.vercel.com/v9/projects/$PROJECT_ID/domains" \
              -H "Authorization: Bearer $VERCEL_TOKEN" \
              -H "Content-Type: application/json" \
              -d "{\"name\":\"$DOMAIN\"}" | python3 -c "
          import sys,json
          d=json.load(sys.stdin)
          if 'error' in d:
              print(f'  ERROR: {d[\"error\"][\"message\"]}')
          else:
              print(f'  Added: {d.get(\"name\")}')
              cfg = d.get('verification') or []
              for v in cfg:
                  print(f'  DNS: {v.get(\"type\")} {v.get(\"domain\")} → {v.get(\"value\")}')
          "
          done

      - name: Add dailydealdarling.com domains
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_BRAND_TOKEN }}
          PROJECT_ID: prj_2y6pPE9KvBY76hr5WVL7Uv21V6tZ
        run: |
          for DOMAIN in dailydealdarling.com www.dailydealdarling.com; do
            echo "Adding $DOMAIN..."
            curl -s -X POST "https://api.vercel.com/v9/projects/$PROJECT_ID/domains" \
              -H "Authorization: Bearer $VERCEL_TOKEN" \
              -H "Content-Type: application/json" \
              -d "{\"name\":\"$DOMAIN\"}" | python3 -c "
          import sys,json
          d=json.load(sys.stdin)
          if 'error' in d:
              print(f'  ERROR: {d[\"error\"][\"message\"]}')
          else:
              print(f'  Added: {d.get(\"name\")}')
              cfg = d.get('verification') or []
              for v in cfg:
                  print(f'  DNS: {v.get(\"type\")} {v.get(\"domain\")} → {v.get(\"value\")}')
          "
          done

      - name: Get DNS records needed
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_BRAND_TOKEN }}
          F35_ID: prj_xJ3y2gstjJktWHGtMpVJPAAIUiFy
          DEALS_ID: prj_2y6pPE9KvBY76hr5WVL7Uv21V6tZ
        run: |
          echo "=== DNS RECORDS NEEDED ==="
          for DOMAIN in fitover35.com www.fitover35.com; do
            echo ""
            echo "--- $DOMAIN ---"
            curl -s "https://api.vercel.com/v9/projects/$F35_ID/domains/$DOMAIN" \
              -H "Authorization: Bearer $VERCEL_TOKEN" | python3 -c "
          import sys,json
          d=json.load(sys.stdin)
          print(f'  Verified: {d.get(\"verified\")}')
          for v in d.get('verification') or []:
              print(f'  {v.get(\"type\")} record: {v.get(\"domain\")} → {v.get(\"value\")}')
          "
          done
          for DOMAIN in dailydealdarling.com www.dailydealdarling.com; do
            echo ""
            echo "--- $DOMAIN ---"
            curl -s "https://api.vercel.com/v9/projects/$DEALS_ID/domains/$DOMAIN" \
              -H "Authorization: Bearer $VERCEL_TOKEN" | python3 -c "
          import sys,json
          d=json.load(sys.stdin)
          print(f'  Verified: {d.get(\"verified\")}')
          for v in d.get('verification') or []:
              print(f'  {v.get(\"type\")} record: {v.get(\"domain\")} → {v.get(\"value\")}')
          "
          done

      - name: Summary
        run: |
          echo "## Custom Domains Added" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Domains have been added to the Vercel projects." >> $GITHUB_STEP_SUMMARY
          echo "Check the job logs above for the DNS records you need to set at your domain registrar." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Standard Vercel DNS records:" >> $GITHUB_STEP_SUMMARY
          echo "| Type | Name | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|---|---|---|" >> $GITHUB_STEP_SUMMARY
          echo "| A | @ (fitover35.com) | 76.76.21.21 |" >> $GITHUB_STEP_SUMMARY
          echo "| CNAME | www | cname.vercel-dns.com |" >> $GITHUB_STEP_SUMMARY
          echo "| A | @ (dailydealdarling.com) | 76.76.21.21 |" >> $GITHUB_STEP_SUMMARY
          echo "| CNAME | www | cname.vercel-dns.com |" >> $GITHUB_STEP_SUMMARY
